<!DOCTYPE html><html lang="zh-CN"><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="cheer up"><meta name="baidu-site-verification" content="9pSIuwCbvi"><meta name="google-site-verification" content="YzcCTjF6VoVlNAtL37_S4vFjzFwYTAFZzD51Il2IGKY"><title>Learn To Rank | WenHuiZhou</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Learn To Rank</h1><a id="logo" href="/.">WenHuiZhou</a><p class="description">perper（打起精神！）</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Learn To Rank</h1><div class="post-meta">Feb 14, 2020<span> | </span><span class="category"><a href="/categories/webSearch/">webSearch</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 阅读</span></span></div><a class="disqus-comment-count" href="/2020/02/14/Learn-To-Rank/#vcomment"><span class="valine-comment-count" data-xid="/2020/02/14/Learn-To-Rank/"></span><span> 条评论</span></a><div class="post-content"><p>Learn To Rank是一种学习方法，通过训练模型来解决排序的问题，在信息检索，NLP，Data Mining领域有着很多的应用。</p>
<a id="more"></a>
<h3 id="排序问题"><a href="#排序问题" class="headerlink" title="排序问题"></a>排序问题</h3><p>在信息检索中，给定一个query，搜索引擎会召回（<strong>粗筛选</strong>）一系列相关的Documents（term匹配，keyword匹配，semantic匹配），之后对这些Documents排序，最后输出Top N的Documents。</p>
<p>排序问题即使用一个模型 f(q,d)来对该query下的documents进行排序，这个模型可以是人工设定一些参数的模型，也可以是用<strong>机器学习算法自动训练出来的模型</strong>。在Web Search领域，因为在Web Search 中，有很多信息可以用来<strong>确定query-doc pair的相关性</strong>，而另一方面，由于大量的搜索日志的存在，可以将<strong>用户的点击行为日志作为training data</strong>，使得通过机器学习自动得到排序模型成为可能。</p>
<p><strong>排序问题的核心在于找出query和doc之间的相关性，对相关性进行排序。</strong></p>
<p>learn to rank 是监督学习，分为train和test两个阶段：</p>
<p><img src="/images/nlp/image-20200214232441639.png" alt="image-20200214232441639"></p>
<h3 id="training-data-set-的生成"><a href="#training-data-set-的生成" class="headerlink" title="training data set 的生成"></a>training data set 的生成</h3><p>由于learning to rank是监督学习，因此对每一条记录都需要label。通常feature vector容易获取，而label实际上反映了query-doc pair的真实相关程度。通常有两种label的获取方式：</p>
<ul>
<li>人工标注，即对抽样出来作为training data的query-doc pair人为地进行相关程度的判断和标注，一般标注的相关程度分为5档：perfect，excellent，good，fair，bad。<ul>
<li>例如，query=“Microsoft”。document为Microsoft的官网是perfect；介绍Microsoft的wikipedia则是excellent；一篇将Microsoft作为其主要话题的网页则是good；一篇只是提到了Microsoft这个词的网页则是fair，而一篇跟Microsoft毫不相关的网页则是bad。人工标注的方法可以通过多人同时进行，最后以类似投票表决的方式决定一个query-doc pair的相关程度，这样可以相对减少各个人的观点不同带来的误差。</li>
</ul>
</li>
<li>通过搜索日志获取。搜索日志记录了人们在实际生活中的搜索行为和相应的点击行为，点击行为隐含了query-doc pair的相关性，所以可以被用来作为query-doc pair的相关程度的判断。一种最简单的方法就是利用同一个query下，不同doc的点击数的多少来作为它们相关程度的大小。</li>
</ul>
<p>通过搜索日志的方式获取的方法存在一些偏差，即用户偏向于点击位置靠前的doc，即便这个doc并不相关或者相关性不高。因此有一些tricky和general的方法用来处理这种“position bias”的偏差：</p>
<ol>
<li>当位置靠后的doc的点击数都比位置靠前的doc的点击数要高了，那么靠后的doc的相关性肯定要比靠前的doc的相关性大。</li>
<li>Joachims等人则提出了一系列去除bias的方法，例如 Click &gt; Skip Above, Last Click &gt; Skip Above, Click &gt; Earlier Click, Click &gt; Skip Previous, Click &gt; No Click Next等。</li>
<li>一个doc的点击数比另一个doc的点击数多，并不一定说明前者比后者更相关。但即使前者比后者位置靠前，两者的点击数相差5-10倍，这时候我们还是愿意相信前者更加相关。</li>
<li>click model，根据用户的点击信息对用户真正看到的doc进行“筛选”，进而能更准确地看出用户到底看到了哪些doc，没有看到哪些doc，更准确反应点击数/展示数（即展现CTR）来确定各个doc的相关性大小。</li>
</ol>
<h3 id="feature-的生成"><a href="#feature-的生成" class="headerlink" title="feature 的生成"></a>feature 的生成</h3><p>一般Learning to Rank的模型的feature分为两大类：relevance 和 importance（hotness），即query-doc pair 的相关性feature，和doc本身的热门程度的feature。两者中具有代表性的分别是 BM25 和 PageRank。</p>
<h3 id="Evaluation"><a href="#Evaluation" class="headerlink" title="Evaluation"></a>Evaluation</h3><p>比较模型的输出结果，和真实结果（ground truth）之间的差异大小。用于Information Retrieval的排序衡量指标通常有：NDCG，MAP等。</p>
<p><strong>NDCG</strong></p>
<p>NDCG表示了从第1位doc到第k位doc的“归一化累积折扣信息增益值”，主要思想是相关性高且等级高的结果，值应该比较高。</p>
<ul>
<li>高关联度的结果比一般关联度的结果更影响最终的指标得分</li>
<li>有高关联度的结果出现在更靠前的位置的时候，指标会越高</li>
</ul>
<p><strong>CG：累计增益cumulative gain</strong></p>
<p>只考虑到了相关性的关联程度，没有考虑到位置的因素，是一个搜素结果相关性分数的总和。<br>$$<br>\mathrm{CG}_{\mathrm{p}}=\sum_{i=1}^{p} r e l_{i}<br>$$<br>rel表示i的相关性。</p>
<p><strong>折损累计增益（DCG）</strong>：</p>
<p>即对每一个CG的结果，除以一个折算值，目的是为了排名越靠前的结果影响力越大：<br>$$<br>\mathrm{DCG}_{\mathrm{p}}=\sum_{i=1}^{p} \frac{r e l_{i}}{\log _{2}(i+1)}=r e l_{1}+\sum_{i=2}^{p} \frac{r e l_{i}}{\log _{2}(i+1)}<br>$$<br><strong>归一化折损累计增益（NDCG）</strong></p>
<p>归一化之后的折损累积增益，由于搜索的词不同，因此返回的检索数量是不同的，DCG是一个累加值，因此没法针对两个不同的结果进行比较，需要求一个归一化之后的结果：<br>$$<br>\mathrm{nDCG}_{\mathrm{p}}=\frac{D C G_{p}}{I D C G_{p}}<br>$$<br>其中IDCG是理想情况下最大的DCG：<br>$$<br>\mathrm{IDCG}_{\mathrm{p}}=\sum_{i=1}^{|R E L|} \frac{2^{r e l_{i}}-1}{\log _{2}(i+1)}<br>$$<br>即从大到小，取前p个结果组成的集合。</p>
<p><strong>MAP</strong></p>
<p>对每个相关文档检索出准确率平均值的算术平均值。首先对每一个query计算一个AP：<br>$$<br>A P=\frac{\sum_{j=1}^{n_{i}} P(j) \cdot y_{i, j}}{\sum_{j=1}^{n_{i}} y_{i, j}}<br>$$<br>$y_{ij}$即每个doc的label（1和0），而每个query-doc pair的P值代表了到$d_{ij}$这个doc所在的位置为止的precision：<br>$$<br>P(j)=\frac{\sum_{k: \pi_{i}(k) \leq \pi_{i}(j)} y_{i, k}}{\pi_{i}(j)}<br>$$<br>其中pi表示排序中的位置。</p>
<h3 id="Formulation"><a href="#Formulation" class="headerlink" title="Formulation"></a>Formulation</h3><p>通过建立一个损失函数，即经验风险函数，通过最小化这个函数来达到模型训练的目的：<br>$$<br>\hat{R}(F)=\frac{1}{m} \sum_{i=1}^{m} L\left(F\left(\mathbf{x}_{i}\right), \mathbf{y}_{i}\right)<br>$$<br>由于上式优化函数不连续，因此我们寻求一个替代函数，通过优化次优函数得到次优解，替代方案有许多种，可以选择的方法有：</p>
<p><strong>pointwise loss</strong></p>
<p>平方误差：<br>$$<br>L^{\prime}(F(\mathbf{x}), \mathbf{y})=\sum_{i=1}^{n}\left(f\left(x_{i}\right)-y_{i}\right)^{2}<br>$$<br><strong>pairwise loss</strong></p>
<p>例如hinge loss，exponential loss，logistic loss等<br>$$<br>L^{\prime}(F(\mathbf{x}), \mathbf{y})=\sum_{i=1}^{n-1} \sum_{j=i+1}^{n} \phi\left(\operatorname{sign}\left(y_{i}-y_{j}\right), f\left(x_{i}\right)-f\left(x_{j}\right)\right)<br>$$<br><strong>listwise loss</strong><br>$$<br>L^{\prime}(F(\mathbf{x}), \mathbf{y})=\exp (-N D C G)<br>$$</p>
<h3 id="Learn-To-Rank"><a href="#Learn-To-Rank" class="headerlink" title="Learn To Rank"></a>Learn To Rank</h3><p><strong>pointwise：</strong>输入数据为单个doc以及query</p>
<p><strong>pairwise：</strong>输入数据为同一个query对应的两个doc，以及query</p>
<p><strong>listwise：</strong>输入数据为同一个query对应的若干doc，以及query</p>
<p>pointwise和pairwise方法将排序问题转化为classification，regression，ordinal classification等问题。而listwise方法则将一个ranking list作为一个instance来进行训练，其实会考虑每个query下所有doc之间的顺序关系。</p>
<p>这三种类型的Learning to Rank方法的具体算法一般有：</p>
<p>1) <strong>Pointwise</strong>: Subset Ranking, McRank, Prank, OC SVM</p>
<p>2) <strong>Pairwise</strong>: Ranking SVM, RankBoost, RankNet, GBRank, IR SVM, Lambda Rank, LambdaMart</p>
<p>3) <strong>Listwise</strong>: ListNet, ListMLE, AdaRank, SVM MAP, Soft Rank</p>
<p><strong>inference</strong></p>
<p>本文为学习笔记，参考如下网页：<a href="https://www.cnblogs.com/bentuwuying/p/6681943.html" target="_blank" rel="noopener">https://www.cnblogs.com/bentuwuying/p/6681943.html</a></p>
</div><div><ul class="post-copyright"><li class="post-copyright-author"><strong>本文作者：</strong>WenHui Zhou</li><li class="post-copyright-link"><strong>本文链接：</strong><a href="/2020/02/14/Learn-To-Rank/">https://wenhui-zhou.github.io/2020/02/14/Learn-To-Rank/</a></li><li class="post-copyright-license"><strong>版权声明：</strong>| 本博客所有文章除特别声明外，均采用 <a href="&quot;http://creativecommons.org/licenses/by-nc-sa/3.0/cn/&quot;" rel="&quot;external" nofollow&quot;="" target="&quot;_blank&quot;">CC BY-NC-SA 3.0 CN</a> 许可协议。转载请注明出处！ </li></ul></div><br><div class="tags"></div><div class="post-nav"><a class="pre" href="/2020/02/16/线性判别函数/">线性判别函数</a><a class="next" href="/2020/02/05/OpenPose-Realtime-Multi-Person-2D-Pose-Estimation-using-Part-Affinity-Fields/">OpenPose: Realtime Multi-Person 2D Pose Estimation using Part Affinity Fields</a></div><div id="vcomment"></div><script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script><script src="//unpkg.com/valine@latest/dist/Valine.min.js"></script><script>var notify = 'false' == true ? true : false;
var verify = 'false' == true ? true : false;
var GUEST_INFO = ['nick','mail','link'];
var guest_info = 'nick,mail'.split(',').filter(function(item){
  return GUEST_INFO.indexOf(item) > -1
});
guest_info = guest_info.length == 0 ? GUEST_INFO :guest_info;
window.valine = new Valine({
  el:'#vcomment',
  notify:notify,
  verify:verify,
  appId:'civq9nKD49NpRALooR9Llqmf-gzGzoHsz',
  appKey:'JggO9HaSi1Lfx17nt16oDfsI',
  placeholder:'Shall we talk',
  avatar:'mm',
  guest_info:guest_info,
  pageSize:'10'
})</script></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/3D重建/">3D重建</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Mac/">Mac</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/NLP/">NLP</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Tensorflow/">Tensorflow</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/effective-cpp/">effective cpp</a><span class="category-list-count">9</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/super-resolution/">super resolution</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/tool/">tool</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/webSearch/">webSearch</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/xigua/">xigua</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/建站/">建站</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/手撕系列/">手撕系列</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/推荐系统/">推荐系统</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/模型评价/">模型评价</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/比赛/">比赛</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/算法扫盲/">算法扫盲</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/统计学习方法/">统计学习方法</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/编程/">编程</a><span class="category-list-count">4</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/论文复现/">论文复现</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/论文阅读/">论文阅读</a><span class="category-list-count">23</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/论文阅读/3D重建/">3D重建</a><span class="category-list-count">1</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目/">项目</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/项目总结/">项目总结</a><span class="category-list-count">5</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/项目总结/论文阅读/">论文阅读</a><span class="category-list-count">3</span></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/tip/" style="font-size: 15px;">tip</a> <a href="/tags/深度学习/" style="font-size: 15px;">深度学习</a> <a href="/tags/leetcode/" style="font-size: 15px;">leetcode</a> <a href="/tags/3D重建/" style="font-size: 15px;">3D重建</a> <a href="/tags/项目总结/" style="font-size: 15px;">项目总结</a> <a href="/tags/c/" style="font-size: 15px;">c++</a> <a href="/tags/论文阅读/" style="font-size: 15px;">论文阅读</a> <a href="/tags/netStation/" style="font-size: 15px;">netStation</a> <a href="/tags/tool/" style="font-size: 15px;">tool</a> <a href="/tags/SR/" style="font-size: 15px;">SR</a> <a href="/tags/dialog/" style="font-size: 15px;">dialog</a> <a href="/tags/interview/" style="font-size: 15px;">interview</a> <a href="/tags/Tensorflow/" style="font-size: 15px;">Tensorflow</a> <a href="/tags/learning-cpp/" style="font-size: 15px;">learning cpp</a> <a href="/tags/NLP/" style="font-size: 15px;">NLP</a> <a href="/tags/—-leetcode/" style="font-size: 15px;">— leetcode</a> <a href="/tags/职业规划/" style="font-size: 15px;">职业规划</a> <a href="/tags/算法/" style="font-size: 15px;">算法</a> <a href="/tags/tips/" style="font-size: 15px;">tips</a> <a href="/tags/超分辨率/" style="font-size: 15px;">超分辨率</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/02/16/线性判别函数/">线性判别函数</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/14/Learn-To-Rank/">Learn To Rank</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/02/05/OpenPose-Realtime-Multi-Person-2D-Pose-Estimation-using-Part-Affinity-Fields/">OpenPose: Realtime Multi-Person 2D Pose Estimation using Part Affinity Fields</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/30/朴素贝叶斯法-4/">朴素贝叶斯法(4)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/29/k近邻法-3/">k近邻法(3)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/29/感知机-2/">感知机(2)</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/26/统计学习方法概述/">统计学习方法概述</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/09/cs224N-word-vector-I/">cs224N word vector I</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/01/01/2019！2020！/">2019！2020！</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/12/29/GPT/">GPT</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="https://github.com/WenHui-Zhou" title="GITHUB" target="_blank">GITHUB</a><ul></ul><a href="http://www.google.com/" title="GOOGLE" target="_blank">GOOGLE</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">WenHuiZhou.</a> 访问人数:<span id="busuanzi_value_site_uv"></span> 
访问量:<span id="busuanzi_value_site_pv"></span></div><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script> </div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js" async></script><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
  });
</script><script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML" async></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>